## Customize the test machine
machine:

  timezone:
    America/Phoenix # Set the timezone

  # Override /etc/hosts
  hosts:
    circlehost: 127.0.0.1

  # Add some environment variables
  environment:
    CIRCLE_ENV: test
    DATABASE_URL: mysql://ubuntu:@127.0.0.1:5432/circle_test

dependencies:
  pre:
    - go get github.com/tools/godep
    - make dep
  override:
    - go build -v -race
  post:
    # install golint
    - go get github.com/golang/lint/golint
    - mysql -u ubuntu -e "create database aion"
    - mysql -u ubuntu -e "CREATE USER 'aion'@'%' IDENTIFIED BY 'aion'"
    - mysql -u ubuntu -e "GRANT ALL PRIVILEGES ON aion.* TO 'aion'@'%'"
    - mysql -u ubuntu -e "FLUSH PRIVILEGES"
    - ./aion -db-user aion -db-pass aion -db-host localhost -db-port 3306 -db-name aion -nsq-host=192.168.99.100 -db-setup

## Customize test commands
test:
  pre:
    - go vet ./...
    - test -z "$(golint ./... | tee /dev/stderr)"
  override:
    - go test -v -race -cover